<div class="dashboard-header">
  <h2>Dashboard</h2>
  <button mat-raised-button color="primary" (click)="exportCSV()">Export as CSV</button>
</div>

<gridster [options]="options">
  @for (item of dashboard; track $index) {
    <gridster-item [item]="item">
      <mat-card class="widget-card">
        <div class="widget-header">
          <span>{{ item.label }}</span>
          
          <!-- Chart type selector for Line Chart widget -->
          @if (item.label === 'Line Chart') {
            <div class="chart-controls">
              <mat-form-field appearance="outline" class="chart-type-selector">
                <mat-label>Chart Type</mat-label>
                <mat-select [(value)]="lineChartType">
                  <mat-option value="line">Line Chart</mat-option>
                  <mat-option value="bar">Bar Chart</mat-option>
                  <mat-option value="pie">Pie Chart</mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          }
          
          <!-- Chart type selector for Bar Chart widget -->
          @if (item.label === 'Bar Chart') {
            <div class="chart-controls">
              <mat-form-field appearance="outline" class="chart-type-selector">
                <mat-label>Chart Type</mat-label>
                <mat-select [(value)]="barChartType">
                  <mat-option value="line">Line Chart</mat-option>
                  <mat-option value="bar">Bar Chart</mat-option>
                  <mat-option value="pie">Pie Chart</mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          }
        </div>
        
        <div class="widget-body">
          @if (item.label === 'Total Sales') {
            <div class="sales">
              <h3>{{ totalSales | currency:'USD':'symbol':'1.0-0' }}</h3>
            </div>
          }
          @else if (item.label === 'Line Chart') {
            <div class="chart-container">
              <div class="chart-header">
                <h4>{{ getChartTitle('line', lineChartType) }}</h4>
              </div>
              <div class="chart-wrapper">
                <canvas baseChart
                        [type]="lineChartType"
                        [data]="getLineChartData()"
                        [options]="getChartOptions(lineChartType)">
                </canvas>
              </div>
            </div>
          }
          @else if (item.label === 'Bar Chart') {
            <div class="chart-container">
              <div class="chart-header">
                <h4>{{ getChartTitle('bar', barChartType) }}</h4>
              </div>
              <div class="chart-wrapper">
                <canvas baseChart
                        [type]="barChartType"
                        [data]="getBarChartData()"
                        [options]="getChartOptions(barChartType)">
                </canvas>
              </div>
            </div>
          }
          @else if (item.label === 'Table') {
            <app-table-widget [sales]="sales"></app-table-widget>
          }
          @else if (item.label === 'Filter Bar') {
            <app-filter-bar></app-filter-bar>
          }
        </div>
      </mat-card>
    </gridster-item>
  }
</gridster>